<!doctype html>
<html>
	<head>
		<title>Game-off 2012</title>
		<link rel="stylesheet" href="/css/style.css" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Dosis:300,600|Ubuntu" />
		<script src="/js/utils.js"></script>
		<script src="/js/controls.js"></script>
		<script src="/js/ticker.js"></script>
		<script src="/js/two/vector.js"></script>
		<script src="/js/author.js"></script>
		<script src="/js/idset.js"></script>
		<script src="/js/direction.js"></script>
		<script src="/js/color.js"></script>
		<script src="/js/commit.js"></script>
		<script src="/js/diff.js"></script>
		<script src="/js/randomplayer.js"></script>
		<script src="/js/world.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	</head>
	<body>
		<div id="wrapper"><canvas id="canvas">If you can see this, your browser sucks</canvas></div>
		<script>
		var world = new World(20, 15);

		var colors = "red orange yellow green blue violet".split(' ');

		var players = colors.map(function(c) {
			var x = Math.round(Math.random() * world.width);
			var y = Math.round(Math.random() * world.height);
			return new RandomPlayer(
				world.get(x, y),
				new Author("Player "+c, c)
			)
		});

		function sequencer(a) {
			var i = 0;
			return function f() {
				if(a.length > i) a[i++]();
			}
		}
		// var testcase = sequencer([
		// 	function() {
		// 		world.diffs.push(new Diff(world, a, b, a.author));
		// 		world.diffs.push(new Diff(world, z, y, z.author));
		// 	},
		// 	function() {
		// 		world.diffs.push(new Diff(world, b, m, b.author));
		// 		world.diffs.push(new Diff(world, y, x, y.author));
		// 	},
		// 	function() {
		// 		world.diffs.push(new Diff(world, x, w, x.author));
		// 		world.diffs.push(new Diff(world, m, n, m.author));
		// 		world.diffs.push(new Diff(world, y, m, y.author));
		// 	}
		// ]);

		var ticker = new Ticker(function() {
			world.tick();

			players.forEach(function(player) {
				player.update();
			});
		}, 1);


		var ctx = canvas.getContext('2d');
		ctx.globalCompositeOperation = 'destination-over'
		$(window).resize(function(){
			canvas.width  = $(canvas).width();
			canvas.height = $(canvas).height();
		}).resize();

		$(document)
			.keyup(Controls.keyUpHandler)
			.keydown(Controls.keyDownHandler);

		ticker.start();
		function draw(t) {
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			world.drawTo(ctx, ticker.progress());
			requestAnimationFrame(draw);
		}
		draw();
		</script>
	</body>
</html>